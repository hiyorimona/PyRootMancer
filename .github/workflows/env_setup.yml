

- name: Run tests with pytest
  run: poetry run pytest --cov=pyrootmancer --cov-report=xml

- name: Generate code coverage report
  uses: actions/upload-artifact@v3
  with:
    name: coverage-report
    path: coverage.xml

- name: Send Slack notification on failure
  if: failure()
  uses: slackapi/slack-github-action@v1.23.0
  with:
    payload: |
      {
        "channel": "#build-notifications",
        "attachments": [
          {
            "color": "danger",
            "text": "Build failed for ${{ github.repository }} on branch ${{ github.ref }}."
          }
        ]
      }
  env:
    SLACK_BOT_TOKEN: ${{ secrets.SLACK_BOT_TOKEN }}
